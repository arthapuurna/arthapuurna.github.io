<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Benakasemmemii â†’ IPA â†’ TTS (eSpeak.js)</title>
<style>
body{font-family:system-ui,Arial,sans-serif;margin:0;padding:24px;background:#f8fafc;color:#0f172a;display:flex;justify-content:center}
.card{max-width:850px;width:100%;background:#fff;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.07);padding:24px}
h1{margin-top:0;font-size:1.3rem}
textarea{width:100%;min-height:120px;font-size:1rem;padding:10px;border:1px solid #ccc;border-radius:8px;resize:vertical}
button{padding:8px 14px;margin:4px;border-radius:8px;cursor:pointer;border:none;font-weight:600}
button.primary{background:#2563eb;color:#fff}
button.secondary{background:transparent;border:1px solid #2563eb;color:#2563eb}
label{font-size:0.9rem;color:#444}
.row{display:flex;flex-wrap:wrap;align-items:center;gap:10px;margin-top:10px}
#output{white-space:pre-wrap;min-height:60px;background:#f1f5f9;border:1px solid #cbd5e1;border-radius:8px;padding:8px;margin-top:8px}
.status{font-size:0.85rem;color:#555;margin-top:8px}
</style>
</head>
<body>
<div class="card">
  <h1>Benakasemmemii â†’ IPA â†’ Speech (eSpeak.js)</h1>

  <label for="input">Benakasemmemii text</label>
  <textarea id="input" placeholder="Type Benakasemmemii text here..."></textarea>

  <div class="row">
    <button id="convert" class="primary">Convert & Speak</button>
    <button id="copyIPA" class="secondary">Copy IPA</button>
    <button id="clear" class="secondary">Clear</button>
  </div>

  <label>IPA result (auto-generated)</label>
  <div id="output"></div>

  <div class="row">
    <label>Rate</label><input id="rate" type="range" min="80" max="220" step="5" value="120">
    <label>Pitch</label><input id="pitch" type="range" min="30" max="120" step="1" value="50">
  </div>

  <div class="status" id="status">Loading eSpeak.jsâ€¦</div>
</div>

<script src="https://unpkg.com/espeak.js/espeak.min.js"></script>
<script>
// --- Benakasemmemii â†’ IPA conversion ---
const mappingOrdered = [
  ["jny","dÊ‘É²"],["ong","Ãµ"],
  ["aa","aË"],["ii","iË"],["uu","uË"],
  ["ei","eË"],["ou","oË"],["ai","aiÌ¯"],["au","auÌ¯"],["eu","euÌ¯"],["oi","oiÌ¯"],["ui","uiÌ¯"],
  ["bh","bÊ±"],["ch","tÉ•"],["dh","dÊ±"],["gh","gÊ±"],["jh","dÊ‘Ê±"],["kh","kÊ°"],["ph","pÊ°"],["th","tÊ°"],["sh","É•"],
  ["rr","r"],["ng","Å‹g"],["nk","Å‹k"],
  ["a","a"],["b","b"],["c","tÉ•"],["d","d"],["e","e"],["f","f"],["g","g"],["h","h"],
  ["i","i"],["j","dÊ‘"],["k","k"],["l","l"],["m","m"],["n","n"],["o","o"],["p","p"],
  ["r","É¾"],["s","s"],["t","t"],["u","u"],["w","Ê‹"],["y","j"],["z","z"],["q","k"],["v","Ê‹"],["x","ks"]
];

function benakasemmemiiToIPA(text){
  let s = text.toLowerCase();
  for(const [src, ipa] of mappingOrdered){
    const re = new RegExp(src,"g");
    s = s.replace(re, ipa);
  }
  return s;
}

// --- eSpeak.js integration ---
let espeak = null;
let ready = false;

(async()=>{
  try{
    espeak = await ESpeak();
    ready = true;
    document.getElementById("status").textContent="eSpeak.js ready âœ…";
  }catch(e){
    document.getElementById("status").textContent="Failed to load eSpeak.js ðŸ˜¢";
  }
})();

async function speakIPA(ipa){
  if(!ready){alert("eSpeak not ready yet!");return;}
  const rate=parseInt(document.getElementById("rate").value,10);
  const pitch=parseInt(document.getElementById("pitch").value,10);
  if(typeof espeak.synth==="function"){
    const wavBytes = await espeak.synth(ipa,{rate,pitch});
    const blob=new Blob([wavBytes],{type:"audio/wav"});
    const url=URL.createObjectURL(blob);
    const audio=new Audio(url);
    audio.play();
    document.getElementById("status").textContent="Playing IPA speechâ€¦";
    audio.onended=()=>{URL.revokeObjectURL(url);document.getElementById("status").textContent="Ready";}
  }else if(typeof espeak.speak==="function"){
    espeak.speak(ipa,{rate,pitch});
    document.getElementById("status").textContent="Playing IPA speech (stream)â€¦";
  }else{
    alert("No valid eSpeak output function found.");
  }
}

// --- UI bindings ---
document.getElementById("convert").addEventListener("click",()=>{
  const text=document.getElementById("input").value.trim();
  if(!text)return;
  const ipa=benakasemmemiiToIPA(text);
  document.getElementById("output").textContent=ipa;
  speakIPA(ipa);
});
document.getElementById("copyIPA").addEventListener("click",()=>{
  const ipa=document.getElementById("output").textContent;
  if(ipa)navigator.clipboard.writeText(ipa);
});
document.getElementById("clear").addEventListener("click",()=>{
  document.getElementById("input").value="";
  document.getElementById("output").textContent="";
});
</script>
</body>
</html>
